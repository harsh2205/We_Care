{% load static %}
<!DOCTYPE html>
<html>

<head>

    <!-- Toastr style -->
    <link href={% static "css/plugins/toastr/toastr.min.css" %} rel="stylesheet">
    <link href={% static "css/tabs.css" %} rel="stylesheet">

    <link href={% static "css/plugins/iCheck/custom.css" %} rel="stylesheet">
    <link href={% static "css/plugins/steps/jquery.steps.css" %} rel="stylesheet">
    <!-- Date Picker style -->
    <link href={% static "css/plugins/datapicker/datepicker3.css" %} rel="stylesheet">
    <!-- Clock Picker style -->
    <link href={% static "css/plugins/clockpicker/clockpicker.css" %} rel="stylesheet">
    <!-- Chosen style -->
    <link href={% static "css/plugins/chosen/bootstrap-chosen.css" %} rel="stylesheet">

    <!-- FooTable -->
    <link href={% static "css/plugins/footable/footable.core.css" %} rel="stylesheet">

    <link href={% static "css/plugins/dataTables/datatables.min.css" %} rel="stylesheet">

    {% include "partials/head.html" %}

    <style>
        .popover {
            z-index: 999999;
        }

        .dataTables_filter, .html5buttons, .dataTables_length {
            text-align: center !important;
            float: none;
        }
    </style>


    <title>INSPINIA | Projects list</title>
</head>

<body class="no-skin-config">

<div id="wrapper">

    {% include 'receptionist/nav.html' %}

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i>
                    </a>
                    <form role="search" class="navbar-form-custom" action="search_results.html">
                        <div class="form-group">
                            <input type="text" placeholder="Search for something..." class="form-control"
                                   name="top-search" id="top-search">
                        </div>
                    </form>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <a href={% url 'logout' %}>
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>

            </nav>
        </div>
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-sm-4">
                <h2>Receptionist Dashboard</h2>
                <ol class="breadcrumb">
                    <li>
                        <a href="#">Home</a>
                    </li>
                    <li class="active">
                        <strong>Dashboard</strong>
                    </li>
                </ol>
            </div>
        </div>
        <div class="row">
            <div class="wrapper wrapper-content">

                {# ====================Search Box==========================#}

                <div class="col-lg-5">
                    <div class=" animated bounceInUp">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Appointment List</h5>

                            </div>
                            <div class="ibox-content">

                                <div class="table-responsive">
                                    <table id="medicine_list"
                                           class="table table-striped table-bordered table-hover dataTables-example">
                                        <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Patient</th>
                                            <th>Doctor</th>

                                        </tr>
                                        </thead>

                                        <tbody>
                                        {% for data in object %}
                                            <tr>
                                                <td>{{ data.date }}</td>
                                                <td>{{ data.startTime }}</td>
                                                <td>{{ data.patient }}</td>
                                                <td>{{ data.doctor }}</td>

                                            </tr>

                                        {% endfor %}


                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Patient</th>
                                            <th>Doctor</th>

                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>

                <div class="col-lg-7">

                    <div class="panel with-nav-tabs panel-default animated fadeInRightBig tabs-container">
                        <div class="panel-heading">
                            <ul id="myTabs" class="nav nav-tabs">
                                <li class="active"><a id="ss" href="#tab1default" data-toggle="tab">Make Appointment</a>
                                </li>
                                <li><a href="#tab2default" data-toggle="tab">Register</a></li>
                               
                            </ul>
                        </div>
                        <div class="panel-body">
                            <div class="tab-content">
                                <div class="tab-pane fade in active" id="tab1default">
                                    <div class="row m-b-sm m-t-sm">
                                        <div class="col-md-12">
                                            <div class="input-group"><input id="search_box" type="text"
                                                                            placeholder="Search"
                                                                            class="input-sm form-control"> <span
                                                    class="input-group-btn">
                                        <button id="search_btn" class="btn btn-sm btn-primary"> Go!</button> </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="table-responsive">

                                        <table id="search_list" class="table table-hover collapse">
                                            <thead>
                                            <th colspan="2">Name</th>
                                            <th> Email Id</th>
                                            <th>Contact Number</th>
                                            <th></th>
                                            </thead>
                                            <tbody>


                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="tab2default">
                                    <form id="register_form" class="form-horizontal">
                                        <div class="form-group"><label class="col-sm-2 control-label"> First
                                            Name</label>

                                            <div class="col-sm-10"><input type="text" id="r_first_name"
                                                                          class="form-control"></div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <div class="form-group"><label class="col-sm-2 control-label">Last Name</label>
                                            <div class="col-sm-10"><input type="text" id="r_last_name"
                                                                          class="form-control">
                                            </div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <div class="form-group"><label class="col-sm-2 control-label">Email</label>

                                            <div class="col-sm-10"><input id="r_email" type="email"
                                                                          class="form-control"></div>
                                        </div>
                                        <div class="hr-line-dashed"></div>

                                        <div class="form-group"><label class="col-sm-2 control-label">Phone
                                            Number</label>

                                            <div class="col-sm-10">
                                                <input id="r_phone_number" type="text" class="form-control"
                                                       data-mask="(999) 999-9999" placeholder="">
                                                <span class="help-block">(999) 999-9999</span>
                                            </div>
                                        </div>
                                        <div class="hr-line-dashed"></div>

                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Birthday Date</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="r_dob" class="form-control"
                                                       data-mask="99/99/9999" placeholder="">
                                                <span class="help-block">MM/DD/YYYY</span>
                                            </div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <div class="form-group"><label class="col-sm-2 control-label">Blood
                                            Group</label>

                                            <div class="col-sm-10"><input id="blood_group" type="text"
                                                                          class="form-control"></div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <button id="r_new_patient_btn" type="button"
                                                class="btn btn-primary center-block">
                                            Register Patient
                                        </button>
                                    </form>
                                </div>
                                {#                                <div class="tab-pane fade" id="tab3default">Default 3</div>#}
                            </div>
                        </div>
                    </div>


                    <!------ Testing Area------>
                    {#                    <div class="ibox-content">#}
                    {#                        <h2>#}
                    {#                            Validation Wizard Form#}
                    {#                        </h2>#}
                    {#                        <p>#}
                    {#                            This example show how to use Steps with jQuery Validation plugin.#}
                    {#                        </p>#}
                    {##}
                    {#                        <form id="form" class="wizard-big">#}
                    {##}
                    {#                            <h1>Symptoms </h1>#}
                    {#                            <fieldset style="width: 100%; float: none">#}
                    {#                                <h2>Patient's Symptoms</h2>#}
                    {#                                <div class="row">#}
                    {#                                    <div class="col-lg-12 text-center">#}
                    {#                                        <textarea required class="form-control" rows="10" id="Symptoms"#}
                    {#                                                  placeholder="Mention Patient's  Symptoms......."></textarea>#}
                    {#                                    </div>#}
                    {##}
                    {#                                </div>#}
                    {#                            </fieldset>#}
                    {##}
                    {##}
                    {#                            <h1>Date & Time</h1>#}
                    {#                            <fieldset>#}
                    {#                                <h2>Search Criteria for Appointment</h2>#}
                    {#                                <div class="row">#}
                    {#                                    <div class="col-lg-8">#}
                    {#                                        <div class="form-group" id="data_1">#}
                    {#                                            <label>Choose Date</label>#}
                    {#                                            <div class="input-group date">#}
                    {#                                                <span class="input-group-addon"><i#}
                    {#                                                        class="fa fa-calendar"></i></span><input required id='appdate'#}
                    {#                                                                                                 type="text"#}
                    {#                                                                                                 class="form-control"#}
                    {#                                                                                                 value="10/31/2017">#}
                    {#                                            </div>#}
                    {#                                        </div>#}
                    {#                                        <label>Select Appointment Start Time</label>#}
                    {#                                        <div class="input-group clockpicker" data-autoclose="true">#}
                    {##}
                    {#                                            <input required id='startTime' type="text" class="form-control"#}
                    {#                                                   value="09:30"/>#}
                    {#                                            <span class="input-group-addon">#}
                    {#                                                <span class="fa fa-clock-o"></span>#}
                    {#                                            </span>#}
                    {#                                        </div>#}
                    {#                                        <br>#}
                    {##}
                    {#                                        <label>Select Appointment End Time</label>#}
                    {#                                        <div class="input-group clockpicker" data-autoclose="true">#}
                    {##}
                    {#                                            <input required id='endTime' type="text" class="form-control"#}
                    {#                                                   value="10:00"/>#}
                    {#                                            <span class="input-group-addon">#}
                    {#                                                <span class="fa fa-clock-o"></span>#}
                    {#                                            </span>#}
                    {#                                        </div>#}
                    {#                                    </div>#}
                    {#                                    <div class="col-lg-4">#}
                    {#                                        <div class="text-center">#}
                    {#                                            <div style="margin-top: 20px">#}
                    {#                                                <i class="fa fa-sign-in" style="font-size: 180px;color: #e5e5e5 "></i>#}
                    {#                                            </div>#}
                    {#                                        </div>#}
                    {#                                    </div>#}
                    {#                                </div>#}
                    {##}
                    {##}
                    {#                                <!---------------------- Step 2--------->#}
                    {#                            </fieldset>#}
                    {##}
                    {##}
                    {#                            <h1>Search Results</h1>#}
                    {#                            <fieldset style="width: 100%; float: none">#}
                    {##}
                    {#                                <div class="row">#}
                    {#                                    <div class="col-lg-12">#}
                    {#                                        <p>#}
                    {#                                            A placeholder value can be defined and will be displayed until a selection#}
                    {#                                            is#}
                    {#                                            made.#}
                    {#                                        </p>#}
                    {#                                        <select id="doctorsSelect" class="select2_demo_3 form-control"#}
                    {#                                                style="width: 100%">#}
                    {#                                            <option></option>#}
                    {#                                            <option value="Bahamas">Bahamas</option>#}
                    {#                                        </select>#}
                    {##}
                    {#                                    </div>#}
                    {#                                </div>#}
                    {##}
                    {##}
                    {#                                <div class="row">#}
                    {#                                    <div id="slot_box" class="col-lg-12 collapse">#}
                    {#                                        <p>#}
                    {#                                            A placeholder value can be defined and will be displayed until a selection#}
                    {#                                            is#}
                    {#                                            made.#}
                    {#                                        </p>#}
                    {#                                        <select id="slotselect" class="select2_demo_3 form-control "#}
                    {#                                                style="width: 100%">#}
                    {#                                            <option></option>#}
                    {#                                            <option value="Bahamas">Bahamas</option>#}
                    {#                                        </select>#}
                    {##}
                    {#                                    </div>#}
                    {#                                </div>#}
                    {##}
                    {#                            </fieldset>#}
                    {##}
                    {#                            <h1>Finish</h1>#}
                    {#                            <fieldset>#}
                    {#                                <h2>Terms and Conditions</h2>#}
                    {#                                <input id="acceptTerms" name="acceptTerms" type="checkbox" class="required"> <label#}
                    {#                                    for="acceptTerms">I agree with the Terms and Conditions.</label>#}
                    {#                            </fieldset>#}
                    {#                        </form>#}
                    {#                    </div>#}


                    <div class="ibox-content">


                        <div class="modal inmodal" id="myModal" role="dialog" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content animated bounceInRight">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal"><span
                                                aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                        </button>
                                        <i class="glyphicon glyphicon-calendar modal-icon" style="font-size: 50px"></i>
                                        <br>

                                        <h5 class="modal-title inline">Book Appointment</h5>
                                    </div>
                                    <div class="modal-body" style="overflow:hidden;">

                                        <form id="form" class="wizard-big">

                                            <h1>Symptoms </h1>
                                            <fieldset style="width: 100%; float: none">
                                                <h2>Patient's Symptoms</h2>
                                                <div class="row">

                                                    <div class="col-lg-12 text-center">
                                                        <input id="patient_id" type="text" class="hidden">
                                                        <textarea required class="form-control" rows="10" id="symptoms"
                                                                  placeholder="Mention Patient's  Symptoms......."></textarea>
                                                    </div>

                                                </div>
                                            </fieldset>


                                            <h1>Date & Time</h1>
                                            <fieldset>
                                                <h2>Search Criteria for Appointment</h2>
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <div class="form-group" id="data_1">
                                                            <label>Choose Date</label>
                                                            <div class="input-group date">
                                                <span class="input-group-addon"><i
                                                        class="fa fa-calendar"></i></span><input required id='appdate'
                                                                                                 type="text"
                                                                                                 class="form-control"
                                                                                                 value="10/31/2017">
                                                            </div>
                                                        </div>
                                                        <label>Select Appointment Start Time</label>
                                                        <div class="input-group clockpicker" data-autoclose="true">

                                                            <input required id='startTime' type="text"
                                                                   class="form-control"
                                                                   value="09:30"/>
                                                            <span class="input-group-addon">
                                                <span class="fa fa-clock-o"></span>
                                            </span>
                                                        </div>
                                                        <br>

                                                        <label>Select Appointment End Time</label>
                                                        <div class="input-group clockpicker" data-autoclose="true">

                                                            <input required id='endTime' type="text"
                                                                   class="form-control"
                                                                   value="10:00"/>
                                                            <span class="input-group-addon">
                                                <span class="fa fa-clock-o"></span>
                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="text-center">
                                                            <div style="margin-top: 20px">
                                                                <i class="fa fa-sign-in"
                                                                   style="font-size: 180px;color: #e5e5e5 "></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <!---------------------- Step 2--------->
                                            </fieldset>


                                            <h1>Search Results</h1>
                                            <fieldset style="width: 100%; float: none">

                                                <div class="row">
                                                    <div class="col-lg-12 ">
                                                        <p>
                                                            A placeholder value can be defined and will be displayed
                                                            until a selection
                                                            is
                                                            made.
                                                        </p>

                                                        <select id="doctorsSelect"
                                                                data-placeholder="Select Doctor..."
                                                                class="chosen-select required" tabindex="2">
                                                            <option></option>
                                                            <option value="Bahamas">Bahamas</option>
                                                        </select>
                                                        <span class="asdf">
                                                        </span>

                                                    </div>
                                                </div>


                                                <div class="row">
                                                    <div id="slot_box" class="col-lg-12 collapse ">
                                                        <p>
                                                            A placeholder value can be defined and will be displayed
                                                            until a selection
                                                            is
                                                            made.
                                                        </p>
                                                        <select id="slotselect"
                                                                data-placeholder="Select Time Slot..."
                                                                class="select2_demo_3 form-control "
                                                                style="width: 100%" required>
                                                            <option></option>
                                                            <option value="Bahamas">Bahamas</option>
                                                        </select>

                                                    </div>
                                                </div>

                                            </fieldset>

                                            <h1>Finish</h1>
                                            <fieldset>
                                                <h2>Terms and Conditions</h2>
                                                <input id="acceptTerms" name="acceptTerms" type="checkbox"
                                                       class="required"> <label
                                                    for="acceptTerms">I agree with the Terms and Conditions.</label>
                                            </fieldset>
                                        </form>

                                    </div>
{#                                    <div class="modal-footer">#}
{#                                        #}
{#                                    </div>#}
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--------- /Testing --------->
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="pull-right">

            </div>
            <div>
                <strong>Copyright</strong> Example Company &copy; 2014-2017
            </div>
        </div>

    </div>
</div>

{% include "partials/footer_scripts.html" %}

<!-- Input Mask-->
<script src={% static "js/plugins/jasny/jasny-bootstrap.min.js" %}></script>
<!-- Toastr script -->
<script src={% static "js/plugins/toastr/toastr.min.js" %}></script>

<!-- Steps -->
<script src={% static "js/plugins/steps/jquery.steps.min.js" %}></script>

<!-- Jquery Validate -->
<script src={% static "js/plugins/validate/jquery.validate.min.js" %}></script>
<!-- Data picker -->
<script src={% static "js/plugins/datapicker/bootstrap-datepicker.js" %}></script>
<!-- Clock picker -->
<script src={% static "js/plugins/clockpicker/clockpicker.js" %}></script>
<!-- Chosen -->
<script src={% static "js/plugins/chosen/chosen.jquery.js" %}></script>
<!-- Input Mask-->
<script src={% static "js/myJs.js" %}></script>
<!-- FooTable -->
<script src={% static "js/plugins/footable/footable.all.min.js" %}></script>
<script src={% static "js/plugins/dataTables/datatables.min.js" %}></script>

<!-- Page-Level Scripts -->
<script>

    function tablerend() {
        $('.dataTables-example').DataTable({
            pageLength: 25,
            responsive: true,
            dom: '<"html5buttons"B>lTfgitp',
            buttons: [
                {extend: 'copy'},
                {extend: 'csv'},
                {extend: 'excel', title: 'ExampleFile'},
                {extend: 'pdf', title: 'ExampleFile'},

                {
                    extend: 'print',
                    customize: function (win) {
                        $(win.document.body).addClass('white-bg');
                        $(win.document.body).css('font-size', '10px');

                        $(win.document.body).find('table')
                            .addClass('compact')
                            .css('font-size', 'inherit');
                    }
                }
            ]

        });

    }

</script>


<script>

    $(document).ready(function () {


        steps_init();
        date_picker();
        tablerend();


        $("#search_btn").click(function () {
            var data = $("#search_box").val();

            if (data.length === 0) {
            }
            else if (isEmail(data)) {
                search_patient('e', data)
            }
            else if (isPhoneNumber(data)) {
                search_patient('p', data)
            }
            else if (hasWhiteSpace(data)) {
                search_patient('fl', data)
            }
            else if (!hasWhiteSpace(data)) {
                search_patient('f', data)
            }


        });


        $("#r_new_patient_btn").click(function () {
            register_patient();
        });

        $('#doctorsSelect').on('change', function (e) {
            var optionSelected = $("option:selected", this);
            var valueSelected = this.value;
            search_slots(valueSelected);
        });

    });


</script>


<script>
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }

    function isPhoneNumber(PhoneNumber) {
        var regex = /\(?([0-9]{3})\)?([ .-]?)([0-9]{3})\2([0-9]{4})/;
        return regex.test(PhoneNumber);
    }

    function hasWhiteSpace(s) {
        return /\s/g.test(s);
    }

    function register_active() {
        $('.nav-tabs a[href="#tab1default"]').tab('show')
    }


    function drop_box(id, placeholder) {
        $(id).chosen({width: "100%"});
    }


    function search_doctor(appdate, startTime, endTime) {

        $.ajax({
            url: "/bookapp",
            type: 'POST',
            data: {
                date: appdate,
                startTime: startTime,
                endTime: endTime,
            },
            dataType: 'json',
            success: function (data) {

                if (data['message'] === "User Already Exists") {
                    errortoast("Please search again !", "Patient Not Found !");
                }
                else {
                    $('#doctorsSelect').html("<option></option>");
                    $.each(data, function (i, item) {
                        $('#doctorsSelect').append($('<option>', {
                            value: data[i].pk,
                            text: data[i].fields.first_name + " " + data[i].fields.last_name,
                        }));
                    });
                    drop_box('#doctorsSelect', "Select Doctor");

                }
            },
            error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                alert(msg)
            }
        });


    }

    function search_slots(doctor_id) {

        appdate = $("#appdate").val();
        startTime = $("#startTime").val();
        endTime = $("#endTime").val();

        $.ajax({
            url: "/slots",
            type: 'POST',
            data: {
                doctor_id: doctor_id,
                appdate: appdate,
                startTime: startTime,
                endTime: endTime
            },
            dataType: 'json',
            success: function (data) {

                if (data['message'] === "User Already Exists") {
                    errortoast("Please search again !", "Patient Not Found !");
                }
                else {
                    $('#slotselect').html("<option></option>");
                    $.each(data, function (i, item) {
                        $('#slotselect').append($('<option>', {
                            value: data[i],
                            text: data[i],
                        }));
                    });
                    $('#slot_box').show();
                    drop_box('#slotselect', "Select Slot");
                }
            },
            error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                alert(msg)
            }
        });

    }

    function book_appointment(patient_id, doctor_id, date, time, symptoms) {

        console.log(time);

        $.ajax({
            url: "/finalbook",
            type: 'POST',
            async: false,
            data: {
                patient_id: patient_id,
                doctor_id: doctor_id,
                appdate: appdate,
                date: date,
                time: time,
                symptoms: $('#symptoms').val()
            },
            dataType: 'json',
            success: function (data) {

                if (data['message'] === "User Already Exists") {
                    errortoast("Please search again !", "Patient Not Found !");
                }
                else {
                    $('#form').trigger("reset");
                    $('#myModal').modal('toggle');
                    sucesstoast("Appointment Successfully Booked !", "Sucess!!!");

                }
            },
            error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                alert(msg)
            }
        });


    }


    function steps_init() {
        $("#wizard").steps();
        $("#form").steps({
            bodyTag: "fieldset",
            onStepChanging: function (event, currentIndex, newIndex) {
                // Always allow going backward even if the current step contains invalid fields!
                if (currentIndex > newIndex) {

                    return true;
                }

                if (currentIndex === 1 && newIndex === 2) {
                    search_doctor($("#appdate").val(), $("#startTime").val(), $("#endTime").val());
                }

                // Forbid suppressing "Warning" step if the user is to young
                if (newIndex === 3 && Number($("#age").val()) < 18) {
                    return false;
                }

                var form = $(this);

                // Clean up if user went backward before
                if (currentIndex < newIndex) {
                    // To remove error styles
                    $(".body:eq(" + newIndex + ") label.error", form).remove();
                    $(".body:eq(" + newIndex + ") .error", form).removeClass("error");
                }

                // Disable validation on fields that are disabled or hidden.
                form.validate().settings.ignore = ":disabled,:hidden";

                // Start validation; Prevent going forward if false
                return form.valid();


            },
            onStepChanged: function (event, currentIndex, priorIndex) {
                // Suppress (skip) "Warning" step if the user is old enough.
                console.log(currentIndex);


                if (currentIndex === 2 && Number($("#age").val()) >= 18) {

                    $(this).steps("next");
                }

                // Suppress (skip) "Warning" step if the user is old enough and wants to the previous step.
                if (currentIndex === 2 && priorIndex === 3) {
                    $(this).steps("previous");
                }
            },
            onFinishing: function (event, currentIndex) {
                var form = $(this);

                // Disable validation on fields that are disabled.
                // At this point it's recommended to do an overall check (mean ignoring only disabled fields)
                form.validate().settings.ignore = ":disabled";

                // Start validation; Prevent form submission if false
                return form.valid();
            },
            onFinished: function (event, currentIndex) {
                var form = $(this);
                book_appointment(
                    $('#patient_id').val(),
                    $('#doctorsSelect').val(),
                    $('#appdate').val(),
                    $('#slotselect').val(),
                    $('#symptoms').text()
                );


                // Submit form input


                //form.submit();
            }
        }).validate({
            errorPlacement: function (error, element) {
                element.before(error);
            },
            rules: {
                confirm: {
                    equalTo: "#password"
                }
            }
        });

        $('.clockpicker').clockpicker({
            'default': '',
            placement: 'top',
            align: 'left',
            twelvehour: true
        });


    }

    function date_picker() {
        $('#data_1 .input-group.date').datepicker({
            todayBtn: "linked",
            format: "mm/dd/yyyy",
            keyboardNavigation: true,
            forceParse: true,
            calendarWeeks: true,
            startDate: new Date(),
            autoclose: true
        });
    }


    function rowRander(response, pk) {
        return template = '<tr><td class="project-people  col-md-1"><a href=""><img alt="image" class="img-circle" src={% static "img/a1.jpg" %}></a></td>\n' +
            '    <td class="project-title col-md-2"><a href="project_detail.html">' + response.first_name + ' ' + response.last_name + '</a><br/></td>\n' +
            '    <td class="project-completion col-md-3"><div>' + response.email + '</div></td>\n' +
            '    <td class="col-md-2" ><div>' + response.phone_number + '</div></td>\n' +
            '    <td class="text-center col-md-3">\n' +
            '\t<a type="button" class="btn label-success btn-circle"><i\n' +
            '                class="glyphicon glyphicon-user"></i></a>\n' +
            '        <a type="button" id="appointment_' + pk + '" class="open-BookDialog btn btn-warning btn-circle" data-toggle="modal" data-target="#myModal"><i\n' +
            '                class="glyphicon glyphicon-calendar"></i></a>\n' +
            '        <a type="button" class="btn btn-danger btn-circle"><i\n' +
            '                class="glyphicon glyphicon-pencil"></i></a>\n' +
            '    </td>\n' +
            '</tr>'
    }


    function search_patient(type, data) {

        var someData = "";
        if (type === 'fl') {
            data = data.split(" ");
            someData = {
                "type": type,
                "first_name": data[0],
                "last_name": data[1]
            }
        }
        else if (type === 'f') {
            data = data.split(" ");
            someData = {
                "type": type,
                "first_name": data[0]
            }
        }
        else if (type === 'p') {
            data = data.split(" ");
            someData = {
                "type": type,
                "phone_number": data[0]
            }
        }
        else if (type === 'e') {
            data = data.split(" ");
            someData = {
                "type": type,
                "email": data[0]
            }
        }
        console.log(someData);

        <!-- Ajax Call -->
        $.ajax({
            url: "/search",
            type: 'POST',
            data: someData,
            dataType: 'json',
            success: function (data) {
                $('#search_list tbody').html("");
                if (!$.trim(data)) {
                    $('#search_list').hide();
                    errortoast("Please search again !", "Patient Not Found !");
                }
                else {
                    toastr.clear();
                    $('#search_list').show();
                    $.each(data,
                        function (i, item) {
                            var response = data[i].fields;
                            row = rowRander(response, data[i].pk);
                            $('#search_list').find('tbody').append(row)
                        })
                }
            },
            error: function (jqXHR, exception) {


                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                console.log(msg)
            }
        });


    }

    function register_patient() {
        $.ajax({
            url: "/register_patient",
            type: 'POST',
            data: {
                first_name: $('#r_first_name').val(),
                last_name: $('#r_last_name').val(),
                email: $('#r_email').val(),
                dob: "2001-12-21",
                blood_group: "O+",
                phone_number: '1234567890'
            },
            dataType: 'json',
            success: function (data) {
                if (data['message'] === "User Already Exists") {
                    errortoast("Please search again !", "Patient Not Found !");
                }
                else {

                    sucesstoast("Patient Successfully Registered!", "Patient Registered.");
                    $('#register_form')[0].reset();
                    $('.nav-tabs a[href="#tab1default"]').tab('show')


                }
            },
            error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                alert(msg)
            }
        });
    }


</script>


<script type="text/javascript">

    function sucesstoast(mainMsg, subMsg) {
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "progressBar": true,
            "preventDuplicates": true,
            "positionClass": "toast-top-right",
            "onclick": null,
            "showDuration": "400",
            "hideDuration": "1000",
            "timeOut": "7000",
            "extendedTimeOut": "0",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };
        toastr.success(mainMsg, subMsg);
    }

    function errortoast(mainMsg, subMsg) {
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "progressBar": true,
            "preventDuplicates": true,
            "positionClass": "toast-top-right",
            "onclick": null,
            "showDuration": "400",
            "hideDuration": "1000",
            "timeOut": "7000",
            "extendedTimeOut": "0",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };
        toastr.error(mainMsg, subMsg);
    }
</script>


<script>
    $('.close').click(function () {
        $('#alert_area').hide();
    });


    $(document).on("click", ".open-BookDialog", function () {
        var ID = $(this).attr("id");
        ID = ID.split("_");
        $('#patient_id').val(ID[1]);
        console.log($('#patient_id').val());
    });


    function alert_close() {
        $(".alert").slideUp(0);
    }
</script>

</body>

</html>


{#                                        <tr>#}
{#                                            <td class="project-people">#}
{#                                                <a href=""><img alt="image" class="img-circle"#}
{#                                                                src={% static "img/a1.jpg" %}></a>#}
{#                                            </td>#}
{#                                            <td class="project-title">#}
{#                                                <a href="project_detail.html">Karan Sheth</a>#}
{#                                                <br/>#}
{#                                            <small>Contact: </small>#}
{#                                            </td>#}
{#                                            <td class="project-completion">#}
{#                                                <div>#}
{#                                                    Karan.sheth60@gmail.com#}
{#                                                </div>#}
{#                                            </td>#}
{#                                            <td>#}
{#                                                <div>#}
{#                                                    +1(518)-253-7514#}
{#                                                </div>#}
{#                                            </td>#}
{#                                            <td class="text-center">#}
{#                                                <a type="button" class="btn label-success btn-circle"><i#}
{#                                                        class="glyphicon glyphicon-user"></i></a>#}
{#                                                <a type="button" class="btn btn-warning btn-circle"><i#}
{#                                                        class="glyphicon glyphicon-calendar"></i></a>#}
{#                                                <a type="button" class="btn btn-danger btn-circle"><i#}
{#                                                        class="glyphicon glyphicon-pencil"></i></a>#}
{#                                            </td>#}
{#                                        </tr>#}